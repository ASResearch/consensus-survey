\section{BFT背景：拜占庭将军问题}
BFT（Byzantine Fault Tolerance的全称是拜占庭容错，是一个能实现状态机复制且能够容忍拜占庭节点的算法。这里的拜占庭节点的就是所谓的恶意节点，其行为可以是任意的（发送错误信息，任意长时间不响应信息，不按照协议运作等等，且各个拜占庭节点之间可以合谋）。

介绍BFT要从广为人知的拜占庭三将军问题（BGP，Byzantine General Problem）说起。这两者容易混淆，但实际BFT指的是一系列容错问题，而BGP是BFT的一个特例。

BGP问题由Lamport在1982年提出\cite{lamport1982byzantine}。所谓三将军BGP问题指的是，有一个指挥官和两个将军，他们需要对进攻或者撤退达成统一的决定，其中他们之间有一个叛徒，这个叛徒就是我们之前提到的拜占庭节点，可以任意行为（如撒谎，不回复等）。
将军们（包括指挥官）之间可以任意轮进行点对点交流。问题要求，如果指挥官是诚实的（不是叛徒），那么所有诚实将军的决定要和指挥官的决定一致。如果指挥官是叛徒，那么所有的将军要做出一致的决定。

常规的BGP问题分为两个部分，分别针对\textbf{同步网络模型}和\textbf{异步网络模型}。

同步网络：所有节点的消息传输的延迟不会超过某个定值$t$（这个$t$是有限且已知的）。

异步网络：所有节点的消息传输延迟可以是任意的（对于诚实节点的只能保证消息一定可达，但是延迟上限未知，且随时间是可变的）。

同步网络是一种理想的网络环境，而我们熟知的BGP在同步网络环境的描述如下:

\textbf{同步网络环境下三将军BGP问题不可解，四将军或以上BGP问题可解}

这个问题的证明是如果指挥官是恶意的，那么他可以给两个将军发出不同的指令。如果指挥官不是叛徒，那么两个将军交流时其中一个将军可以谎报指挥官的指令。具体细节这里不介绍，可以参阅知乎专栏\cite{zhihuBFT}。值得注意的是这里的不可能与后面提到的FLP没有关系，因为是同步网络环境，仅由数学上的推导即可得出。

这个问题（同步BGP）在四将军（包括指挥官）情况下是有解的。同时可以推广为，假设拜占庭节点 （将军）的数目为$f$，当且仅当将军总数大于等于$3f+1$时BGP问题是有解的。

当然对于同步三将军BGP，Lamport提出的解决方案就是加入签名\cite{lamport1979constructing}，加入了签名之后，即便全世界只有两个将军是诚实的而其他将军全是叛徒，这两个将军也能达成共识。这其实就是前段时间疯传的V神发现了$99\%$共识算法。

\textbf{异步网络环境下BGP问题无解}

如前所述，异步网络环境下消息传输延迟可以使任意长且可变。这种情况下只要存在一个叛徒BGP问题就无解。这是由分布式系统的经典结论，FLP不可能定理得出\cite{fischer1982impossibility}。主要原因当一个节点长时间未接收到消息时，他无法判定对方是恶意节点故意不发还是对方是诚实的但因延迟消息还未传过来。书\cite{wattenhofer2016science}第三章有对FLP问题的详细证明。	

这里注意到拜占庭节点“不说话”事实上在异步BGP问题中更具杀伤力，因为有了签名的存在，任何节点能伪造的信息有限（容易被查出），而“不说话”让其他节点无法分辨是恶意节点还是消息没达到。退而求其次的，人们开始在给定某些假设的情况下研究BGP问题：假设指挥官一定会发信息（可以说假话，但一定会到达），且可以引入签名，这种情况下三将军BGP能不能解决。这种假设在\cite{zhihuBFT}叫“弱终止假设”（或者可以理解为半异步假设。这个假设仅仅针对BGP问题，在实际中并不常见）

\textbf{弱终止假设环境下三将军BGP问题无解，四将军或以上问题有解}

同样，该结论可推广为当且仅当$3f+1$或以上将军可解。

BGP的结论总结如下：

\begin{tabular}{|c|c|c|c|c|}
环境	& 同步（无签名）& 同步（带签名）& 异步  & 弱终止 \\\hline
有解所需最少将军数 &  $3f+1$ &   2   &   $f>0$必无解  &    $3f+1$ \\    
\end{tabular}